/**
 * @license
 * canvas-pip-fullscreen
 * @author danrossi / https://github.com/danrossi
 * Copyright (c) 2017 Google
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var pip=function(e){"use strict";const t=new WeakMap;class i{constructor(){t.set(this,{})}on(e,i){const n=t.get(this);return n[e]||(n[e]=[]),n[e].push(i),this}once(e,t){const i=(...n)=>{this.off(e,i),t(...n)};return this.on(e,i),this}off(e,i){const n=t.get(this)[e];return n&&(null===i?n.length=0:n.splice(n.indexOf(i),1)),this}listeners(e){try{return t.get(this)[e]}catch(e){return null}}emit(e,...i){const n=t.get(this)[e];return n&&n.length?(n.forEach((t=>{t({type:e,target:this},...i)})),!0):this}emitAsync(e,...i){const n=t.get(this)[e],s=[];return n&&n.length&&n.forEach((t=>{s.push(t({type:e,target:this},...i))})),Promise.all(s)}}
/**
     * @license
     * pip-manager
     * @author danrossi / https://github.com/danrossi
     * Copyright (c) 2017 Google
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const n=new WeakMap;class s{constructor(){n.set(this,{})}on(e,t){const i=n.get(this);return i[e]||(i[e]=[]),i[e].push(t),this}once(e,t){const i=(...n)=>{this.off(e,i),t(...n)};return this.on(e,i),this}off(e,t){const i=n.get(this)[e];return i&&(null===t?i.length=0:i.splice(i.indexOf(t),1)),this}listeners(e){try{return n.get(this)[e]}catch(e){return null}}emit(e,...t){const i=n.get(this)[e];return i&&i.length?(i.forEach((i=>{i({type:e,target:this},...t)})),!0):this}emitAsync(e,...t){const i=n.get(this)[e],s=[];return i&&i.length&&i.forEach((i=>{s.push(i({type:e,target:this},...t))})),Promise.all(s)}}let a,r=!1,o=!1;class c{static get supported(){return r="pictureInPictureEnabled"in document,o="webkitSupportsPresentationMode"in HTMLVideoElement.prototype,r||o}static get webkitSupport(){return o}static get chromeSupport(){return r}}class l extends s{constructor(){super(),this.pictureInPictureElement=!1}initVideo(){const e=()=>{this.emit("disabled",0===this.videoEl.readyState||this.videoEl.disablePictureInPicture)};e(),this.videoEl.addEventListener("loadedmetadata",e),this.videoEl.addEventListener("emptied",e)}set video(e){this.videoEl=e,this.initVideo()}init(e){this.video=e,c.webkitSupport?this.initWebkitEvents():this.initChromeEvents()}initWebkitEvents(){document.addEventListener("webkitpresentationmodechanged",(e=>this.onWebkitPresentationChanged(e)),!0)}initChromeEvents(){this.videoEl.addEventListener("enterpictureinpicture",(e=>{a=e.pictureInPictureWindow,this.emit("enterpictureinpicture",a),this.onPipWindowResizeRef=()=>this.onPipWindowResize(),a.addEventListener("resize",this.onPipWindowResizeRef)})),this.videoEl.addEventListener("leavepictureinpicture",(e=>{this.emit("leavepictureinpicture"),a.removeEventListener("resize",this.onPipWindowResizeRef)}))}onWebkitPresentationChanged(e){const t=e.target;"picture-in-picture"==t.webkitPresentationMode?this.emit("enterpictureinpicture",t):document.pictureInPictureElement==t&&this.emit("leavepictureinpicture")}onPipWindowResize(e){this.emit("resize",e)}toggleChromePip(){document.pictureInPictureElement?document.exitPictureInPicture().catch((e=>{this.emit("failed",e)})):this.videoEl.requestPictureInPicture().catch((e=>{this.emit("failed",e)}))}toggleWebkitPip(){document.pictureInPictureElement?this.videoEl.webkitSetPresentationMode("inline"):this.videoEl.webkitSetPresentationMode("picture-in-picture")}togglePictureInPicture(){c.webkitSupport?this.toggleWebkitPip():this.toggleChromePip()}}class u extends i{constructor(e,t){super(),this._renderingCanvas=e,this._video=t}set video(e){this.pipManager&&(this.pipManager.video=e)}init(){const e=this.pipVRVideo=document.createElement("video"),t=new l(e);e.setAttribute("autoplay",!0),e.setAttribute("webkit-playsinline",""),e.setAttribute("playsinline",""),this.onPipMetadata=()=>{e.removeEventListener("loadedmetadata",this.onPipMetadata),t.togglePictureInPicture()};const i=(e,...t)=>{this.emit(e.type,t[0],t[1])};if(t.on("enterpictureinpicture",(e=>{i(e,!0)})).on("leavepictureinpicture",(t=>{i(t,!0),e.style.display="none",e.srcObject.getTracks().forEach((e=>e.stop()))})).on("failed",((e,t)=>{i(e,!0,t)})),this._video){const e=this.pipManager=new l(this._video);e.on("enterpictureinpicture",(e=>{i(e,!1)})).on("leavepictureinpicture",(e=>{i(e,!1)})).on("failed",((e,t)=>{i(e,!1,t)})).on("disabled",((e,t)=>{i(e,!1,t)})),e.init(this._video)}t.init(e)}requestVRPip(){this.pipVRVideo.style.display="block",this.pipVRVideo.addEventListener("loadedmetadata",this.onPipMetadata),this.pipVRVideo.srcObject=this._renderingCanvas.captureStream(30),this.pipVRVideo.play()}togglePictureInPicture(e=!0){e?this.requestVRPip():this.pipManager&&this.pipManager.togglePictureInPicture()}}class d extends i{constructor(e){super(),this.init(e)}init(e){const t=this._video=document.createElement("video");this._canvas=e,t.setAttribute("autoplay",!0),t.style.display="none",t.addEventListener("pause",(()=>{this.emit("fspause"),this.isPaused=!0})),t.addEventListener("play",(()=>{this.isPaused&&(this.emit("fsplay"),this.isPaused=!1)}));const i=()=>{t.style.display="block",this.emit("webkitbeginfullscreen")},n=()=>{t.style.display="none",t.srcObject.getTracks().forEach((e=>e.stop())),this.emit("webkitendfullscreen")};document.addEventListener("webkitfullscreenchange",(function(e){t.webkitDisplayingFullscreen?i():n()})),t.addEventListener("webkitbeginfullscreen",i),t.addEventListener("webkitendfullscreen",n),t.addEventListener("loadedmetadata",(()=>{t.style.display="block",t.play().catch((e=>{console.log(e)})),t.webkitEnterFullScreen()}))}requestFullscreen(){this._video.srcObject=this._canvas.captureStream(30)}exitFullscreen(){this._video.webkitExitFullScreen()}get video(){return this._video}}
/**
     * @license
     * screenlock-polyfill
     * @author danrossi / https://github.com/danrossi
     * Copyright (c) 2017 Google
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class h{static get isIOS(){return/iP(hone|ad)/i.test(navigator.platform)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1}static requireOrientationPermission(){return void 0!==window.DeviceOrientationEvent&&"function"==typeof window.DeviceOrientationEvent.requestPermission}static requestOrientationPermissions(){return window.DeviceOrientationEvent.requestPermission()}}const p="requestVideoFrameCallback"in HTMLVideoElement.prototype,m=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,v=window.cancelAnimationFrame||window.mozCancelAnimationFrame;let g;return e.CanvasPipFullscreen=class extends i{constructor(e,t){super(),this._canvas=e,this._video=t}initPip(){this.canvasPip=new u(this._canvas,this._video);const e=(e,...t)=>{this.emit(e.type,t[0],t[1])};this.canvasPip.on("enterpictureinpicture",e).on("leavepictureinpicture",e).on("failed",e).on("disabled",e),this.canvasPip.init()}initFullscreen(){const e=(e,...t)=>{this.emit(e.type,t[0],t[1])};this.canvasFullScreen=new d(this._canvas),this.canvasFullScreen.on("webkitbeginfullscreen",e).on("webkitendfullscreen",e).on("fsplay",e).on("fspause",e)}set video(e){this.canvasPip&&(this.canvasPip.video=e)}get canvasVideo(){return this.canvasFullScreen&&this.canvasFullScreen.video}togglePictureInPicture(e=!0){this.canvasPip.togglePictureInPicture(e)}requestFullscreen(){this.canvasFullScreen&&this.canvasFullScreen.requestFullscreen()}exitFullscreen(){this.canvasFullScreen&&this.canvasFullScreen.exitFullscreen()}},e.CanvasPipFullscreenUtil=class{static get fullScreenAvailable(){return document.fullscreenEnabled||document.mozFullscreenEnabled||document.webkitFullscreenEnabled||document.msFullscreenEnabled}static get isIOS(){return h.isIOS}static get IOSFullscreenAvailable(){return h.isIOS&&this.fullScreenAvailable}static get pipSupported(){return c.supported}},e.VideoAnimation=class{constructor(e,t){this.callback=e,this.video=t,this.animationID=null,this.running=!1}setCallback(e){this.callback=e}async animateLegacy(){const e=this.video.currentTime;e>g&&((1/(e-g)).toFixed(),await this.callback(e,{width:this.video.videoWidth,height:this.video.videoHeight})),g=e,this.animationID=m((async()=>await this.animateLegacy()))}async animate(e,t){await this.callback(e,t),this.video.requestVideoFrameCallback(this.animateRef)}initAnimate(){this.animateRef=async(e,t)=>await this.animate(e,t),this.video.requestVideoFrameCallback(this.animateRef)}initLegacyAnimate(){this.animateLegacy()}start(){this.stop(),p?this.initAnimate():(g=new Date,this.initLegacyAnimate()),this.running=!0}stop(){this.running=!1,p?this.animateRef=()=>{}:v(this.animationID&&this.animationID.data&&this.animationID.data.handleId||this.animationID)}},Object.defineProperty(e,"__esModule",{value:!0}),e}({});
