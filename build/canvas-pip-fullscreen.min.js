/**
 * @license
 * canvas-pip-fullscreen
 * @author danrossi / https://github.com/danrossi
 * Copyright (c) 2017 Google
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var pip=function(e){"use strict";const t=new WeakMap;class i{constructor(){t.set(this,{})}on(e,i){const n=t.get(this);return n[e]||(n[e]=[]),n[e].push(i),this}once(e,t){const i=(...n)=>{this.off(e,i),t(...n)};return this.on(e,i),this}off(e,i){const n=t.get(this)[e];return n&&(null===i?n.length=0:n.splice(n.indexOf(i),1)),this}listeners(e){try{return t.get(this)[e]}catch(e){return null}}emit(e,...i){const n=t.get(this)[e];return n&&n.length?(n.forEach((t=>{t({type:e,target:this},...i)})),!0):this}emitAsync(e,...i){const n=t.get(this)[e],s=[];return n&&n.length&&n.forEach((t=>{s.push(t({type:e,target:this},...i))})),Promise.all(s)}}
/**
     * @license
     * pip-manager
     * @author danrossi / https://github.com/danrossi
     * Copyright (c) 2017 Google
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const n=new WeakMap;class s{constructor(){n.set(this,{})}on(e,t){const i=n.get(this);return i[e]||(i[e]=[]),i[e].push(t),this}once(e,t){const i=(...n)=>{this.off(e,i),t(...n)};return this.on(e,i),this}off(e,t){const i=n.get(this)[e];return i&&(null===t?i.length=0:i.splice(i.indexOf(t),1)),this}listeners(e){try{return n.get(this)[e]}catch(e){return null}}emit(e,...t){const i=n.get(this)[e];return i&&i.length?(i.forEach((i=>{i({type:e,target:this},...t)})),!0):this}emitAsync(e,...t){const i=n.get(this)[e],s=[];return i&&i.length&&i.forEach((i=>{s.push(i({type:e,target:this},...t))})),Promise.all(s)}}let a,r=!1,c=!1;class o{static get supported(){return r="pictureInPictureEnabled"in document,c="webkitSupportsPresentationMode"in HTMLVideoElement.prototype,r||c}static get webkitSupport(){return c}static get chromeSupport(){return r}}class l extends s{constructor(){super(),this.pictureInPictureElement=!1}initVideo(){const e=()=>{this.emit("disabled",0===this.videoEl.readyState||this.videoEl.disablePictureInPicture)};e(),this.videoEl.addEventListener("loadedmetadata",e),this.videoEl.addEventListener("emptied",e)}set video(e){this.videoEl=e,this.initVideo()}init(e){this.video=e,o.webkitSupport?this.initWebkitEvents():this.initChromeEvents()}initWebkitEvents(){document.addEventListener("webkitpresentationmodechanged",(e=>this.onWebkitPresentationChanged(e)),!0)}initChromeEvents(){this.videoEl.addEventListener("enterpictureinpicture",(e=>{a=e.pictureInPictureWindow,this.emit("enterpictureinpicture",a),this.onPipWindowResizeRef=()=>this.onPipWindowResize(),a.addEventListener("resize",this.onPipWindowResizeRef)})),this.videoEl.addEventListener("leavepictureinpicture",(e=>{this.emit("leavepictureinpicture"),a.removeEventListener("resize",this.onPipWindowResizeRef)}))}onWebkitPresentationChanged(e){const t=e.target;"picture-in-picture"==t.webkitPresentationMode?this.emit("enterpictureinpicture",t):document.pictureInPictureElement==t&&this.emit("leavepictureinpicture")}onPipWindowResize(e){this.emit("resize",e)}toggleChromePip(){document.pictureInPictureElement?document.exitPictureInPicture().catch((e=>{this.emit("failed",e)})):this.videoEl.requestPictureInPicture().catch((e=>{this.emit("failed",e)}))}toggleWebkitPip(){document.pictureInPictureElement?this.videoEl.webkitSetPresentationMode("inline"):this.videoEl.webkitSetPresentationMode("picture-in-picture")}togglePictureInPicture(){o.webkitSupport?this.toggleWebkitPip():this.toggleChromePip()}}class u extends i{constructor(e,t,i){super(),this._renderingCanvas=e,this._video=t,this._canvasVideo=i,this.pipEnabled=!1}set video(e){this.pipManager&&(this.pipManager.video=e)}init(){const e=this.pipVRVideo=this._canvasVideo,t=new l(e);this.onPipMetadata=()=>{e.removeEventListener("loadedmetadata",this.onPipMetadata),this.pipEnabled&&t.togglePictureInPicture()};const i=(e,...t)=>{this.emit(e.type,t[0],t[1])};if(t.on("enterpictureinpicture",(e=>{i(e,!0)})).on("leavepictureinpicture",(t=>{i(t,!0),e.style.display="none",e.srcObject.getTracks().forEach((e=>e.stop())),this.pipEnabled=!1})).on("failed",((e,t)=>{i(e,!0,t),this.pipEnabled=!1})),this._video){const e=this.pipManager=new l(this._video);e.on("enterpictureinpicture",(e=>{i(e,!1)})).on("leavepictureinpicture",(e=>{i(e,!1)})).on("failed",((e,t)=>{i(e,!1,t)})).on("disabled",((e,t)=>{i(e,!1,t)})),e.init(this._video)}t.init(e)}requestVRPip(){this.pipEnabled=!0,this.pipVRVideo.style.display="block",this.pipVRVideo.addEventListener("loadedmetadata",this.onPipMetadata),this.pipVRVideo.srcObject=this._renderingCanvas.captureStream(30)}togglePictureInPicture(e=!0){e?this.requestVRPip():this.pipManager&&this.pipManager.togglePictureInPicture()}}class h extends i{constructor(e,t){super(),this.init(e,t)}init(e,t){const i=this._video=t;this._canvas=e,i.style.display="none",i.addEventListener("pause",(()=>{this.emit("fspause"),this.isPaused=!0})),i.addEventListener("play",(()=>{this.isPaused&&(this.emit("fsplay"),this.isPaused=!1)}));const n=()=>{i.style.display="block",this.emit("webkitbeginfullscreen")},s=()=>{i.style.display="none",i.srcObject&&i.srcObject.getTracks().forEach((e=>e.stop())),document.removeEventListener("webkitfullscreenchange",this.onFullscreenChangeRef),this.emit("webkitendfullscreen")};this.onFullscreenChangeRef=e=>{i.webkitDisplayingFullscreen?n():s()},i.addEventListener("webkitbeginfullscreen",n),i.addEventListener("webkitendfullscreen",s),i.addEventListener("loadedmetadata",(()=>{i.style.display="block",i.play().catch((e=>{console.log(e)})),i.webkitEnterFullScreen()}))}requestFullscreen(){document.addEventListener("webkitfullscreenchange",this.onFullscreenChangeRef),this._video.srcObject=this._canvas.captureStream(30)}exitFullscreen(){this._video.webkitExitFullScreen()}}
/**
     * @license
     * screenlock-polyfill
     * @author danrossi / https://github.com/danrossi
     * Copyright (c) 2017 Google
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class d{static get isIOS(){return/iP(hone|ad)/i.test(navigator.platform)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1}static requireOrientationPermission(){return void 0!==window.DeviceOrientationEvent&&"function"==typeof window.DeviceOrientationEvent.requestPermission}static requestOrientationPermissions(){return window.DeviceOrientationEvent.requestPermission()}}class p{static get fullScreenAvailable(){return document.fullscreenEnabled||document.mozFullscreenEnabled||document.webkitFullscreenEnabled||document.msFullscreenEnabled}static get isIOS(){return d.isIOS}static get IOSFullscreenAvailable(){return d.isIOS&&this.fullScreenAvailable}static get pipSupported(){return o.supported}}const v="requestVideoFrameCallback"in HTMLVideoElement.prototype,m=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,g=window.cancelAnimationFrame||window.mozCancelAnimationFrame;let P;return e.CanvasFullscreen=h,e.CanvasPictureInPicture=u,e.CanvasPipFullscreen=class extends i{constructor(e,t,i=!1){super(),this._canvas=e,this._video=t,this._requiresDom=!1,this._forceFs=i}async init(){return new Promise((e=>{this.initCanvasVideo();const t=p.isIOS,i=p.pipSupported;i&&this.initPip(),this._requiresDom=t&&i,!t||p.fullScreenAvailable&&!this._forceFs||(this._requiresDom=!0,this.initFullscreen()),e(this._requiresDom)}))}static get pipSupported(){return p.pipSupported}static get fullScreenAvailable(){return p.fullScreenAvailable}get requiresDom(){return this._requiresDom}initCanvasVideo(){(this._canvasVideo=document.createElement("video")).setAttribute("autoplay",!0)}initPip(){this.canvasPip=new u(this._canvas,this._video,this._canvasVideo);const e=(e,...t)=>{this.emit(e.type,t[0],t[1])};this.canvasPip.on("enterpictureinpicture",e).on("leavepictureinpicture",e).on("failed",e).on("disabled",e),this.canvasPip.init()}initFullscreen(){const e=(e,...t)=>{this.emit(e.type,t[0],t[1])};this.canvasFullScreen=new h(this._canvas,this._canvasVideo),this.canvasFullScreen.on("webkitbeginfullscreen",e).on("webkitendfullscreen",e).on("fsplay",e).on("fspause",e)}set video(e){this.canvasPip&&(this.canvasPip.video=e)}get canvasVideo(){return this._canvasVideo}togglePictureInPicture(e=!0){this.canvasPip.togglePictureInPicture(e)}requestFullscreen(){this.canvasFullScreen&&this.canvasFullScreen.requestFullscreen()}exitFullscreen(){this.canvasFullScreen&&this.canvasFullScreen.exitFullscreen()}},e.CanvasPipFullscreenUtil=p,e.VideoAnimation=class{constructor(e,t){this.callback=e,this.video=t,this.animationID=null,this.running=!1}setCallback(e){this.callback=e}async animateLegacy(){const e=this.video.currentTime;e>P&&((1/(e-P)).toFixed(),await this.callback(e,{width:this.video.videoWidth,height:this.video.videoHeight})),P=e,this.animationID=m((async()=>await this.animateLegacy()))}async animate(e,t){await this.callback(e,t),this.video.requestVideoFrameCallback(this.animateRef)}initAnimate(){this.animateRef=async(e,t)=>await this.animate(e,t),this.video.requestVideoFrameCallback(this.animateRef)}initLegacyAnimate(){this.animateLegacy()}start(){this.stop(),v?this.initAnimate():(P=new Date,this.initLegacyAnimate()),this.running=!0}stop(){this.running=!1,v?this.animateRef=()=>{}:g(this.animationID&&this.animationID.data&&this.animationID.data.handleId||this.animationID)}},Object.defineProperty(e,"__esModule",{value:!0}),e}({});
