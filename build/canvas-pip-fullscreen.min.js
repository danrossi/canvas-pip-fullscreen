/**
 * @license
 * canvas-pip-fullscreen
 * @author danrossi / https://github.com/danrossi
 * Copyright (c) 2017 Google
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var pip=function(t){"use strict";const i=new WeakMap;class n{constructor(){i.set(this,{})}on(e,t){const n=i.get(this);return n[e]||(n[e]=[]),n[e].push(t),this}once(e,t){const i=(...n)=>{this.off(e,i),t(...n)};return this.on(e,i),this}off(e,t){const n=i.get(this)[e];return n&&(null===t?n.length=0:n.splice(n.indexOf(t),1)),this}listeners(e){try{return i.get(this)[e]}catch(e){return null}}emit(e,...t){const n=i.get(this)[e];return n&&n.length?(n.forEach((i=>{i({type:e,target:this},...t)})),!0):this}emitAsync(e,...t){const n=i.get(this)[e],s=[];return n&&n.length&&n.forEach((i=>{s.push(i({type:e,target:this},...t))})),Promise.all(s)}}
/**
     * @license
     * pip-manager
     * @author danrossi / https://github.com/danrossi
     * Copyright (c) 2017 Google
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const s=new WeakMap;class r{constructor(){s.set(this,{})}on(e,t){const i=s.get(this);return i[e]||(i[e]=[]),i[e].push(t),this}once(e,t){const i=(...n)=>{this.off(e,i),t(...n)};return this.on(e,i),this}off(e,t){const i=s.get(this)[e];return i&&(null===t?i.length=0:i.splice(i.indexOf(t),1)),this}listeners(e){try{return s.get(this)[e]}catch(e){return null}}emit(e,...t){const i=s.get(this)[e];return i&&i.length?(i.forEach((i=>{i({type:e,target:this},...t)})),!0):this}emitAsync(e,...t){const i=s.get(this)[e],n=[];return i&&i.length&&i.forEach((i=>{n.push(i({type:e,target:this},...t))})),Promise.all(n)}}let c,a=!1,o=!1;class u{static get supported(){return a="pictureInPictureEnabled"in document,o="webkitSupportsPresentationMode"in HTMLVideoElement.prototype,a||o}static get webkitSupport(){return o}static get chromeSupport(){return a}}class l extends r{constructor(e){super(),this.pictureInPictureElement=!1,this.video=e}initVideo(){const e=()=>{this.emit("disabled",0===this.videoEl.readyState||this.videoEl.disablePictureInPicture)};e(),this.videoEl.addEventListener("loadedmetadata",e),this.videoEl.addEventListener("emptied",e)}set video(e){this.videoEl=e,this.initVideo()}init(){u.webkitSupport?this.initWebkitEvents():this.initChromeEvents()}initWebkitEvents(){document.addEventListener("webkitpresentationmodechanged",(e=>this.onWebkitPresentationChanged(e)),!0)}initChromeEvents(){this.videoEl.addEventListener("enterpictureinpicture",(e=>{c=e.pictureInPictureWindow,this.emit("enterpictureinpicture",c),this.onPipWindowResizeRef=()=>this.onPipWindowResize(),c.addEventListener("resize",this.onPipWindowResizeRef)})),this.videoEl.addEventListener("leavepictureinpicture",(e=>{this.emit("leavepictureinpicture"),c.removeEventListener("resize",this.onPipWindowResizeRef)}))}onWebkitPresentationChanged(e){const t=e.target;"picture-in-picture"==t.webkitPresentationMode?(document.pictureInPictureElement=t,this.emit("enterpictureinpicture",t)):document.pictureInPictureElement==t&&(document.pictureInPictureElement=null,this.emit("leavepictureinpicture"))}onPipWindowResize(e){this.emit("resize",e)}toggleChromePip(){document.pictureInPictureElement?document.exitPictureInPicture().catch((e=>{this.emit("failed",e)})):this.videoEl.requestPictureInPicture().catch((e=>{this.emit("failed",e)}))}toggleWebkitPip(){document.pictureInPictureElement?this.videoEl.webkitSetPresentationMode("inline"):this.videoEl.webkitSetPresentationMode("picture-in-picture")}togglePictureInPicture(){u.webkitSupport?this.toggleWebkitPip():this.toggleChromePip()}}class d extends n{constructor(e,t){super(),this.init(e,t)}set video(e){this.pipManager&&(this.pipManager.video=e)}init(t,i){this.renderingCanvas=t;const n=this.pipVRVideo=document.createElement("video"),s=new l(n);n.setAttribute("autoplay",!0),n.setAttribute("webkit-playsinline",""),n.setAttribute("playsinline",""),this.onPipMetadata=()=>{n.removeEventListener("loadedmetadata",this.onPipMetadata),s.togglePictureInPicture()};const r=(e,...t)=>{this.emit(e.type,t)};if(s.on("enterpictureinpicture",(e=>{r(e,!0)})).on("leavepictureinpicture",(e=>{r(e,!0),n.srcObject.getTracks().forEach((e=>e.stop()))})).on("failed",((e,t)=>{r(e,!0,t)})).on("disabled",((e,t)=>{r(e,!0,t)})),i){const t=this.pipManager=new l(i);t.on("enterpictureinpicture",(t=>{r(e,!1)})).on("leavepictureinpicture",(t=>{r(e,!1)})).on("failed",((e,t)=>{r(e,!1,t)})).on("disabled",((e,t)=>{r(e,!1,t)})),t.init()}s.init()}requestVRPip(){console.log("Request vr pip"),this.pipVRVideo.addEventListener("loadedmetadata",this.onPipMetadata),this.pipVRVideo.srcObject=this.renderingCanvas.captureStream(30),this.pipVRVideo.play()}togglePictureInPicture(e=!0){e?this.requestVRPip():this.pipManager&&this.pipManager.togglePictureInPicture()}}class p extends n{constructor(e){super(),this.init(e)}init(e){const t=this._video=document.createElement("video");this.canvas=e,t.setAttribute("autoplay",!0),t.setAttribute("webkit-playsinline",""),t.setAttribute("playsinline",""),t.style.display="none",t.addEventListener("pause",(()=>{this.emit("paused"),this.isPaused=!0})),t.addEventListener("play",(()=>{this.isPaused&&(this.emit("playing"),this.isPaused=!1)})),t.addEventListener("webkitbeginfullscreen",(()=>{this._video.style.display="block",this.emit("webkitbeginfullscreen")})),t.addEventListener("webkitendfullscreen",(()=>{t.style.display="none",t.srcObject.getTracks().forEach((e=>e.stop())),this.emit("webkitendfullscreen")})),t.addEventListener("loadedmetadata",(()=>{t.webkitEnterFullScreen()}))}requestFullscreen(){this._video.srcObject=this.canvas.captureStream(30),this._video.play().catch((()=>{}))}exitFullscreen(){this._video.webkitExitFullScreen()}get video(){return this._video}}
/**
     * @license
     * screenlock-polyfill
     * @author danrossi / https://github.com/danrossi
     * Copyright (c) 2017 Google
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class h{static get isIOS(){return/iP(hone|ad)/i.test(navigator.platform)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1}static requireOrientationPermission(){return void 0!==window.DeviceOrientationEvent&&"function"==typeof window.DeviceOrientationEvent.requestPermission}static requestOrientationPermissions(){return window.DeviceOrientationEvent.requestPermission()}}return t.CanvasPipFullscreen=class extends n{constructor(e,t){super(),this.canvas=e,this.video=t}initPip(){this.canvasPip=new d(this.canvas,this.video);const e=(e,...t)=>{this.emit(e.type,t)};this.canvasPip.on("enterpictureinpicture",e).on("leavepictureinpicture",e).on("failed",e).on("disabled",e)}initFullscreen(){const e=(e,...t)=>{this.emit(e.type,t)};this.canvasFullScreen=new p(this.canvas),this.canvasFullScreen.on("webkitbeginfullscreen",e).on("webkitendfullscreen",e)}set video(e){this.canvasPip&&(this.canvasPip.video=e)}get canvasVideo(){return this.canvasFullScreen&&this.canvasFullScreen.video}togglePictureInPicture(e=!0){this.canvasPip.togglePictureInPicture(e)}requestFullscreen(){this.canvasFullScreen&&this.canvasFullScreen.requestFullscreen()}exitFullscreen(){this.canvasFullScreen&&this.canvasFullScreen.exitFullscreen()}},t.CanvasPipFullscreenUtil=class{static get fullScreenAvailable(){return document.fullscreenEnabled||document.mozFullscreenEnabled||document.webkitFullscreenEnabled||document.msFullscreenEnabled}static get isIOS(){return h.isIOS}static get IOSFullscreenAvailable(){return h.isIOS&&this.fullScreenAvailable}static get pipSupported(){return u.supported}},Object.defineProperty(t,"__esModule",{value:!0}),t}({});
